corrlattice <- function(data, skip=1, size=100, Steps=10, 
                        start.col=NULL, nodraw=F) {

  library(lattice)
  startexists <- with(.GlobalEnv, exists(".corrlattice.start"))
  if(!is.null(start.col)) {
    .corrlattice.start <- start.col
  }
  else if(startexists) {
    .corrlattice.start <- with(.GlobalEnv, .corrlattice.start)
  }
  else {
    .corrlattice.start <- 7
  }
  .corrlattice.start <<- .corrlattice.start + skip * Steps
  
  selecao <- seq(from=.corrlattice.start, by=skip, length.out=size)
  selected <- data[,selecao]
  
  corr <- abs(cor(selected, use="pairwise.complete.obs"))
  if(!nodraw) {
    toplot <- levelplot(corr, main="", xlab="", ylab="", cuts=size, 
            at=seq(0,1,length.out=size+1), 
            col.regions=colorRampPalette(c("white", "red")))
    plot(toplot)
  }
  return(invisible(corr))
  
}
